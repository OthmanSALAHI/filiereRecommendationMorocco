{% extends "base.html" %}
{% block content %}

<section class="hero">
    <img src="{{ url_for('static', filename='images/e35316c2-b391-4bd4-ac99-06214bc0193b.jpg') }}">
    <div>
        <h1>Student Dashboard</h1>
        <p>End-to-end visualization of student data and AI recommendations.</p>
    </div>
</section>

<section class="card">
    <h2>Student Information</h2>

    <div class="kpi-container">
        <div class="kpi">
            <h3>BAC Mean</h3>
            <p>{{ student.bac_mean }}</p>
        </div>
        <div class="kpi">
            <h3>Math Grade</h3>
            <p>{{ student.math_grade }}</p>
        </div>
        <div class="kpi">
            <h3>Physics/Chemistry</h3>
            <p>{{ student.pc_grade }}</p>
        </div>
        <div class="kpi">
            <h3>French Grade</h3>
            <p>{{ student.fr_grade }}</p>
        </div>
        <div class="kpi">
            <h3>BAC Field</h3>
            <p>{{ student.bac_field }}</p>
        </div>
    </div>

    <hr>

    <h2>AI Recommendations</h2>
    <ul>
        {% for rec in recommendations %}
            <li>{{ rec }}</li>
        {% endfor %}
    </ul>

    <h2>Recommendation Chart</h2>
    <div id="recommendation-chart" style="width:100%;height:400px;"></div>
</section>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    // âœ… Corrected: handle empty recommendations safely
    const recs = {{ recommendations | default([]) | tojson | safe }};

    // Generate random demo values for chart
    const values = recs.map(() => Math.floor(Math.random() * 100) + 10);

    const data = [{
        type: 'pie',
        labels: recs,
        values: values,
        textinfo: 'label+percent',
        insidetextorientation: 'radial'
    }];

    const layout = {
        title: 'AI Suggested Paths',
        paper_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#ffd700' }
    };

    Plotly.newPlot('recommendation-chart', data, layout);
</script>

{% endblock %}
